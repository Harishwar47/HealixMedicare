<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Healix MediCare</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        :root {
            --primary-blue: #2f80ed;
            --primary-teal: #00b49a;
            --admin-red: #dc3545;
            --admin-dark: #343a40;
            --light-blue: #e6f2ff;
            --text-dark: #2c3e50;
            --text-muted: #7f8c8d;
            --success-green: #27ae60;
            --warning-orange: #f39c12;
            --danger-red: #e74c3c;
        }

        body {
            background: linear-gradient(135deg, #f8fafc 0%, #fff5f5 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .dashboard-header {
            background: linear-gradient(90deg, var(--admin-dark), var(--admin-red));
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .card-header-custom {
            background: linear-gradient(90deg, var(--admin-dark), var(--admin-red));
            color: white;
            padding: 20px;
            font-weight: 600;
        }

        .user-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transition: transform 0.2s ease;
        }

        .user-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .btn-primary-custom {
            background: linear-gradient(90deg, var(--admin-dark), var(--admin-red));
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary-custom:hover {
            background: linear-gradient(90deg, #495057, #c82333);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .quick-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            flex: 1;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }

        /* Centered Notification Styles */
        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            z-index: 10000;
            display: none;
            text-align: center;
            min-width: 300px;
            border: 2px solid;
        }
        
        .notification.success {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        
        .notification.error {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .notification .icon {
            font-size: 48px;
            margin-bottom: 10px;
            display: block;
        }
        
        .notification.success .icon::before {
            content: "✓";
            color: #28a745;
        }
        
        .notification.error .icon::before {
            content: "✗";
            color: #dc3545;
        }
        
        .notification .message {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .notification-ok-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            min-width: 60px;
        }
        
        .notification-ok-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Confirmation Dialog */
        .confirmation-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            z-index: 10000;
            display: none;
            text-align: center;
            min-width: 400px;
        }
        
        .confirmation-dialog .dialog-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 15px;
        }
        
        .confirmation-dialog .dialog-message {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 20px;
        }
        
        .confirmation-dialog .dialog-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .confirmation-dialog .dialog-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .confirmation-dialog .btn-confirm {
            background: #dc3545;
            color: white;
        }
        
        .confirmation-dialog .btn-cancel {
            background: #6c757d;
            color: white;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
            display: none;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--admin-dark), var(--admin-red));
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--admin-red);
        }

        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .nav-item {
            padding: 12px 0;
            border-bottom: 1px solid #f1f3f4;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-item:hover {
            background: var(--light-blue);
            border-radius: 8px;
            padding-left: 15px;
        }

        .nav-item.active {
            background: #ffe6e6;
            border-radius: 8px;
            padding-left: 15px;
            border-left: 4px solid var(--admin-red);
        }

        .role-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .role-admin {
            background: rgba(220, 53, 69, 0.1);
            color: var(--admin-red);
        }

        .role-doctor {
            background: rgba(142, 68, 173, 0.1);
            color: #8e44ad;
        }

        .role-patient {
            background: rgba(47, 128, 237, 0.1);
            color: var(--primary-blue);
        }

        .system-alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .table th {
            background: linear-gradient(90deg, var(--admin-dark), var(--admin-red));
            color: white;
            border: none;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Overlay for modals -->
    <div class="overlay" id="overlay"></div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <span class="icon"></span>
        <p class="message" id="notificationMessage"></p>
        <button class="notification-ok-btn" id="notificationOkBtn" onclick="closeNotification()">OK</button>
    </div>
    
    <!-- Confirmation Dialog -->
    <div class="confirmation-dialog" id="confirmationDialog">
        <div class="dialog-title" id="dialogTitle">Confirm Action</div>
        <div class="dialog-message" id="dialogMessage">Are you sure you want to proceed?</div>
        <div class="dialog-buttons">
            <button class="dialog-btn btn-confirm" id="confirmBtn">Confirm</button>
            <button class="dialog-btn btn-cancel" id="cancelBtn">Cancel</button>
        </div>
    </div>

    <!-- Header -->
    <div class="dashboard-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2>Admin Dashboard</h2>
                    <p class="mb-0">System Management & Overview</p>
                </div>
                <div>
                    <span class="me-3">Welcome, <strong th:text="${username}">admin407</strong></span>
                    <a href="/logout" class="btn btn-outline-light">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-4">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3">
                <div class="sidebar">
                    <h5 class="text-center mb-4">Admin Panel</h5>
                    <div class="nav-item active" data-section="overview">
                        <i class="fas fa-tachometer-alt"></i> System Overview
                    </div>
                    <div class="nav-item" data-section="users">
                        <i class="fas fa-users"></i> User Management
                    </div>
                    <div class="nav-item" data-section="doctors">
                        <i class="fas fa-user-md"></i> Doctor Registration
                    </div>
                    <div class="nav-item" data-section="appointments">
                        <i class="fas fa-calendar-alt"></i> Appointments
                    </div>
                    <div class="nav-item" data-section="reports">
                        <i class="fas fa-chart-line"></i> System Reports
                    </div>
                    <div class="nav-item" data-section="settings">
                        <i class="fas fa-cogs"></i> Settings
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9">
                <!-- System Alerts -->
                <div class="system-alert">
                    <strong><i class="fas fa-info-circle"></i> System Status:</strong>
                    All systems operational. Last backup: Oct 26, 2025 at 2:00 AM
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <div class="stat-card">
                        <div class="stat-number" th:text="${#lists.size(users)}">4</div>
                        <div>Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" th:text="${#lists.size(doctors)}">2</div>
                        <div>Active Doctors</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" th:text="${#lists.size(appointments)}">1</div>
                        <div>Total Appointments</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">99.9%</div>
                        <div>System Uptime</div>
                    </div>
                </div>

                <!-- System Overview Section -->
                <div id="overview-section" class="content-section">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="dashboard-card">
                                <div class="card-header-custom">
                                    <h5><i class="fas fa-chart-bar"></i> Recent Activity</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <small class="text-muted">5 min ago</small><br>
                                            New patient registration: PAT003
                                        </li>
                                        <li class="mb-2">
                                            <small class="text-muted">15 min ago</small><br>
                                            Appointment scheduled with Dr. Alice
                                        </li>
                                        <li class="mb-2">
                                            <small class="text-muted">1 hour ago</small><br>
                                            System backup completed
                                        </li>
                                        <li class="mb-2">
                                            <small class="text-muted">2 hours ago</small><br>
                                            Dr. Bob updated profile
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="dashboard-card">
                                <div class="card-header-custom">
                                    <h5><i class="fas fa-exclamation-triangle"></i> System Alerts</h5>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-warning alert-sm">
                                        <strong>Low Storage:</strong> Database storage at 75%
                                    </div>
                                    <div class="alert alert-info alert-sm">
                                        <strong>Scheduled Maintenance:</strong> Oct 30, 2025 at 3:00 AM
                                    </div>
                                    <div class="alert alert-success alert-sm">
                                        <strong>Security:</strong> All systems secure
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Management Section -->
                <div id="users-section" class="content-section" style="display: none;">
                    <div class="dashboard-card">
                        <div class="card-header-custom">
                            <div class="d-flex justify-content-between align-items-center">
                                <h4><i class="fas fa-users"></i> User Management</h4>
                                <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#addUserModal">
                                    <i class="fas fa-plus"></i> Add User
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>Username</th>
                                            <th>Role</th>
                                            <th>Status</th>
                                            <th>Last Login</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="user : ${users}">
                                            <td>
                                                <div class="fw-bold" th:text="${user.fullName != null ? user.fullName : user.username}">John Smith</div>
                                                <small class="text-muted" th:text="${'ID: ' + user.username}">ID: admin407</small>
                                            </td>
                                            <td>
                                                <span th:each="role : ${user.roles}" 
                                                      th:class="'role-badge role-' + ${role.name().toLowerCase().replace('role_', '')}"
                                                      th:text="${role.name().replace('ROLE_', '')}">ADMIN</span>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">Active</span>
                                            </td>
                                            <td>Oct 26, 2025</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary" th:data-username="${user.username}" onclick="editUser(this.dataset.username)">
                                                    <i class="fas fa-edit"></i> Edit
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger ms-1" 
                                                        th:data-username="${user.username}" onclick="deleteUser(this.dataset.username)"
                                                        th:unless="${user.username == 'admin407'}">
                                                    <i class="fas fa-trash"></i> Delete
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Doctor Registration Section -->
                <div id="doctors-section" class="content-section" style="display: none;">
                    <div class="dashboard-card">
                        <div class="card-header-custom">
                            <h4><i class="fas fa-user-md"></i> Doctor Registration</h4>
                        </div>
                        <div class="card-body p-4">
                            <form id="doctorRegistrationForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Doctor Name</label>
                                        <input type="text" class="form-control" id="doctorName" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Doctor ID</label>
                                        <input type="text" class="form-control" id="doctorUsername" placeholder="Auto-generated (DR####)" readonly>
                                        <small class="text-muted">Doctor ID will be automatically generated</small>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Specialty</label>
                                        <select class="form-select" id="doctorSpecialty" required>
                                            <option value="">Select Specialty...</option>
                                            <option value="Cardiology">Cardiology</option>
                                            <option value="Dermatology">Dermatology</option>
                                            <option value="Orthopedics">Orthopedics</option>
                                            <option value="Pediatrics">Pediatrics</option>
                                            <option value="Neurology">Neurology</option>
                                            <option value="Psychiatry">Psychiatry</option>
                                            <option value="Radiology">Radiology</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Password</label>
                                        <input type="password" class="form-control" id="doctorPassword" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" id="doctorEmail" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Phone</label>
                                        <input type="tel" class="form-control" id="doctorPhone">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Available Time Slots</label>
                                    <input type="text" class="form-control" id="availableSlots" 
                                           placeholder="09:00,09:30,10:00,10:30" 
                                           value="09:00,09:30,10:00,10:30,11:00,11:30,14:00,14:30,15:00,15:30">
                                </div>
                                <button type="submit" class="btn btn-primary-custom">
                                    <i class="fas fa-user-plus"></i> Register Doctor
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Current Doctors List -->
                    <div class="dashboard-card">
                        <div class="card-header-custom">
                            <h5><i class="fas fa-list"></i> Current Doctors</h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Username</th>
                                            <th>Specialty</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="doctor : ${doctors}">
                                            <td th:text="${doctor.name}">Dr. Alice</td>
                                            <td th:text="${doctor.username}">dralice</td>
                                            <td th:text="${doctor.specialty}">Cardiology</td>
                                            <td><span class="badge bg-success">Active</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary" th:data-doctor-id="${doctor.id}" onclick="editDoctor(this.dataset.doctorId)">
                                                    <i class="fas fa-edit"></i> Edit
                                                </button>
                                                <button class="btn btn-sm btn-outline-warning ms-1" th:data-doctor-id="${doctor.id}" onclick="suspendDoctor(this.dataset.doctorId)">
                                                    <i class="fas fa-pause"></i> Suspend
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Appointments Section -->
                <div id="appointments-section" class="content-section" style="display: none;">
                    <div class="dashboard-card">
                        <div class="card-header-custom">
                            <h4><i class="fas fa-calendar-alt"></i> All Appointments</h4>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Patient</th>
                                            <th>Doctor</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="appointment : ${appointments}">
                                            <td th:text="${appointment.date}">Oct 26, 2025</td>
                                            <td th:text="${appointment.formattedTime}">10:00 AM</td>
                                            <td th:text="${appointment.patientName != null ? appointment.patientName : (appointment.patient != null ? appointment.patient.username : 'Unknown')}">patient</td>
                                            <td th:text="${appointment.doctor?.name}">Dr. Alice</td>
                                            <td>
                                                <span th:if="${appointment.confirmed}" class="badge bg-success">Confirmed</span>
                                                <span th:unless="${appointment.confirmed}" class="badge bg-warning">Pending</span>
                                            </td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-info" th:data-appointment-id="${appointment.id}" onclick="viewAppointment(this.dataset.appointmentId)">
                                                    <i class="fas fa-eye"></i> View
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger ms-1" th:data-appointment-id="${appointment.id}" onclick="cancelAppointment(this.dataset.appointmentId)">
                                                    <i class="fas fa-times"></i> Cancel
                                                </button>
                                            </td>
                                        </tr>
                                        <tr th:if="${#lists.isEmpty(appointments)}">
                                            <td colspan="6" class="text-center py-4 text-muted">
                                                No appointments found
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Appointment Details Modal -->
                <div class="modal fade" id="appointmentModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-calendar-check"></i> Appointment Details
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="text-primary"><i class="fas fa-user"></i> Patient Information</h6>
                                        <table class="table table-sm table-borderless">
                                            <tr>
                                                <td><strong>Full Name:</strong></td>
                                                <td id="modalPatientFullName">-</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Username:</strong></td>
                                                <td id="modalPatientUsername">-</td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="text-primary"><i class="fas fa-user-md"></i> Doctor Information</h6>
                                        <table class="table table-sm table-borderless">
                                            <tr>
                                                <td><strong>Name:</strong></td>
                                                <td id="modalDoctorName">-</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Specialty:</strong></td>
                                                <td id="modalDoctorSpecialty">-</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-md-12">
                                        <h6 class="text-primary"><i class="fas fa-calendar-alt"></i> Appointment Information</h6>
                                        <table class="table table-sm table-borderless">
                                            <tr>
                                                <td><strong>Date:</strong></td>
                                                <td id="modalAppointmentDate">-</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Time:</strong></td>
                                                <td id="modalAppointmentTime">-</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Reason:</strong></td>
                                                <td id="modalAppointmentReason">-</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Status:</strong></td>
                                                <td id="modalAppointmentStatus">-</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reports-section" class="content-section" style="display: none;">
                    <div class="dashboard-card">
                        <div class="card-header-custom">
                            <h4><i class="fas fa-chart-line"></i> System Reports</h4>
                        </div>
                        <div class="card-body p-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Monthly Statistics</h6>
                                    <ul class="list-unstyled">
                                        <li class="mb-2"><strong>New Users:</strong> 23</li>
                                        <li class="mb-2"><strong>Total Appointments:</strong> 156</li>
                                        <li class="mb-2"><strong>System Uptime:</strong> 99.9%</li>
                                        <li class="mb-2"><strong>Active Doctors:</strong> <span th:text="${#lists.size(doctors)}">2</span></li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6>Popular Specialties</h6>
                                    <ul class="list-unstyled">
                                        <li class="mb-2">1. Cardiology (45 appointments)</li>
                                        <li class="mb-2">2. Dermatology (32 appointments)</li>
                                        <li class="mb-2">3. Orthopedics (28 appointments)</li>
                                        <li class="mb-2">4. Pediatrics (22 appointments)</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mt-4">
                                <button class="btn btn-primary-custom">
                                    <i class="fas fa-download"></i> Export Full Report
                                </button>
                                <button class="btn btn-outline-secondary ms-2">
                                    <i class="fas fa-print"></i> Print Summary
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings-section" class="content-section" style="display: none;">
                    <div class="dashboard-card">
                        <div class="card-header-custom">
                            <h4><i class="fas fa-cogs"></i> System Settings</h4>
                        </div>
                        <div class="card-body p-4">
                            <form id="systemSettingsForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">System Name</label>
                                        <input type="text" class="form-control" value="Healix MediCare" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Time Zone</label>
                                        <select class="form-select">
                                            <option>UTC-5 (Eastern Time)</option>
                                            <option>UTC-8 (Pacific Time)</option>
                                            <option>UTC+0 (GMT)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Backup Frequency</label>
                                        <select class="form-select">
                                            <option>Daily</option>
                                            <option>Weekly</option>
                                            <option>Monthly</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Session Timeout (minutes)</label>
                                        <input type="number" class="form-control" value="30" min="15" max="120">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="maintenanceMode">
                                        <label class="form-check-label" for="maintenanceMode">
                                            Enable Maintenance Mode
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                                        <label class="form-check-label" for="emailNotifications">
                                            Email Notifications
                                        </label>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary-custom">
                                    <i class="fas fa-save"></i> Save Settings
                                </button>
                                <button type="button" class="btn btn-outline-danger ms-2" onclick="performBackup()">
                                    <i class="fas fa-database"></i> Manual Backup
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addUserForm">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="newUsername" placeholder="Enter full name" required>
                            <small class="text-muted">User ID will be auto-generated</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="newPassword" placeholder="Enter password" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="newRole" required>
                                <option value="">Select Role...</option>
                                <option value="ROLE_PATIENT">Patient</option>
                                <option value="ROLE_DOCTOR">Doctor</option>
                            </select>
                            <small class="text-muted">Admin accounts cannot be created through this interface</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary-custom" onclick="createUser()">Create User</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check for success parameter
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('success') === 'login') {
                showNotification('Login successful! Welcome to admin dashboard.', 'success');
                // Clean the URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
            
            // Navigation functionality
            const navItems = document.querySelectorAll('.nav-item');
            const contentSections = document.querySelectorAll('.content-section');

            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const targetSection = this.dataset.section;
                    
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    contentSections.forEach(section => {
                        section.style.display = 'none';
                    });
                    document.getElementById(targetSection + '-section').style.display = 'block';
                });
            });

            // Doctor registration form
            document.getElementById('doctorRegistrationForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    fullName: document.getElementById('doctorName').value,
                    specialty: document.getElementById('doctorSpecialty').value,
                    password: document.getElementById('doctorPassword').value,
                    email: document.getElementById('doctorEmail').value,
                    availableSlots: document.getElementById('availableSlots').value
                };

                // Submit to server
                fetch('/api/register-doctor', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.doctorId) {
                        alert(`Doctor registered successfully!\nDoctor ID: ${data.doctorId}`);
                        document.getElementById('doctorUsername').value = data.doctorId;
                        setTimeout(() => location.reload(), 2000);
                    } else {
                        alert('Error: ' + (data.error || 'Registration failed'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error registering doctor. Please try again.');
                });
            });
        });

        // Admin functions
        function editUser(username) {
            showNotification(`User profile editor opened for: ${username}`, 'success');
        }

        function deleteUser(username) {
            showConfirmDialog(
                'Delete User',
                `Are you sure you want to delete user: ${username}?`,
                () => {
                    fetch('/api/delete-user', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ username: username })
                    })
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        } else if (response.status === 404) {
                            throw new Error('User not found');
                        } else {
                            return response.json().then(data => {
                                throw new Error(data.error || 'Failed to delete user');
                            });
                        }
                    })
                    .then(data => {
                        showNotification(data.message || 'User deleted successfully', 'success');
                        // Remove the user row from the table instead of reloading
                        const userRow = document.querySelector(`[data-username="${username}"]`).closest('tr');
                        if (userRow) {
                            userRow.remove();
                        }
                        // Update user count if it exists
                        const userCountElement = document.querySelector('#user-count');
                        if (userCountElement) {
                            const currentCount = parseInt(userCountElement.textContent);
                            userCountElement.textContent = currentCount - 1;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showNotification('Error: ' + error.message, 'error');
                    });
                }
            );
        }

        function editDoctor(doctorId) {
            // For now, show a simple prompt to edit doctor details
            const name = prompt('Enter new doctor name:');
            if (name) {
                const specialty = prompt('Enter doctor specialty:');
                if (specialty) {
                    const slots = prompt('Enter available slots (comma separated):');
                    if (slots) {
                        fetch('/api/doctor/edit', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                doctorId: doctorId,
                                name: name,
                                specialty: specialty,
                                availableSlots: slots
                            })
                        })
                        .then(response => {
                            if (!response.ok) {
                                return response.json().then(data => Promise.reject(new Error(data.error || 'Unknown error')));
                            }
                            return response.json();
                        })
                        .then(data => {
                            alert('Doctor updated successfully!');
                            location.reload();
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('Error: ' + error.message);
                        });
                    }
                }
            }
        }

        // Notification functions
        function showNotification(message, type, redirectUrl = null) {
            const notification = document.getElementById('notification');
            const messageEl = document.getElementById('notificationMessage');
            const overlay = document.getElementById('overlay');
            
            messageEl.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            overlay.style.display = 'block';
            
            // Store redirect URL for later use
            notification.dataset.redirectUrl = redirectUrl || '';
        }
        
        function closeNotification() {
            const notification = document.getElementById('notification');
            const overlay = document.getElementById('overlay');
            const redirectUrl = notification.dataset.redirectUrl;
            
            notification.style.display = 'none';
            overlay.style.display = 'none';
            
            // Redirect if URL is provided
            if (redirectUrl) {
                window.location.href = redirectUrl;
            }
        }
        
        function showConfirmDialog(title, message, onConfirm) {
            const dialog = document.getElementById('confirmationDialog');
            const titleEl = document.getElementById('dialogTitle');
            const messageEl = document.getElementById('dialogMessage');
            const confirmBtn = document.getElementById('confirmBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const overlay = document.getElementById('overlay');
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            dialog.style.display = 'block';
            overlay.style.display = 'block';
            
            confirmBtn.onclick = () => {
                dialog.style.display = 'none';
                overlay.style.display = 'none';
                onConfirm();
            };
            
            cancelBtn.onclick = () => {
                dialog.style.display = 'none';
                overlay.style.display = 'none';
            };
            
            overlay.onclick = () => {
                dialog.style.display = 'none';
                overlay.style.display = 'none';
            };
        }

        function suspendDoctor(doctorId) {
            showConfirmDialog(
                'Suspend Doctor',
                'Are you sure you want to suspend this doctor? This will remove their profile and all appointments.',
                () => {
                    fetch('/api/doctor/suspend', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            doctorId: doctorId
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(data => Promise.reject(new Error(data.error || 'Unknown error')));
                        }
                        return response.json();
                    })
                    .then(data => {
                        showNotification('Doctor suspended successfully!', 'success');
                        setTimeout(() => {
                            // Stay on current page instead of redirecting to system overview
                            window.location.reload();
                        }, 2000);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showNotification('Error: ' + error.message, 'error');
                    });
                }
            );
        }

        function viewAppointment(appointmentId) {
            // Fetch appointment details and show modal
            fetch(`/api/appointments/${appointmentId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.id) {
                        // Populate modal with appointment details
                        document.getElementById('modalPatientFullName').textContent = data.patientFullName;
                        document.getElementById('modalPatientUsername').textContent = data.patientUsername;
                        document.getElementById('modalDoctorName').textContent = data.doctorName;
                        document.getElementById('modalDoctorSpecialty').textContent = data.doctorSpecialty;
                        document.getElementById('modalAppointmentDate').textContent = data.date;
                        document.getElementById('modalAppointmentTime').textContent = data.time;
                        document.getElementById('modalAppointmentReason').textContent = data.reason;
                        
                        // Set status with appropriate badge
                        const statusElement = document.getElementById('modalAppointmentStatus');
                        if (data.confirmed) {
                            statusElement.innerHTML = '<span class="badge bg-success">Confirmed</span>';
                        } else {
                            statusElement.innerHTML = '<span class="badge bg-warning">Pending Confirmation</span>';
                        }
                        
                        // Show modal
                        const modal = new bootstrap.Modal(document.getElementById('appointmentModal'));
                        modal.show();
                    } else {
                        alert('Error loading appointment details: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error loading appointment details');
                });
        }

        function cancelAppointment(appointmentId) {
            if (confirm('Are you sure you want to cancel this appointment?')) {
                alert(`Appointment cancelled successfully!`);
                location.reload();
            }
        }

        function createUser() {
            const fullName = document.getElementById('newUsername').value; // Using as full name for now
            const password = document.getElementById('newPassword').value;
            const role = document.getElementById('newRole').value;

            if (fullName && password && role) {
                const userData = {
                    fullName: fullName,
                    password: password,
                    role: role,
                    email: fullName.toLowerCase().replace(' ', '.') + '@example.com'
                };

                fetch('/api/create-user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.userId) {
                        alert(`User created successfully!\nUser ID: ${data.userId}`);
                        document.getElementById('addUserForm').reset();
                        bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
                        location.reload();
                    } else {
                        alert('Error: ' + (data.error || 'Failed to create user'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error creating user. Please try again.');
                });
            } else {
                alert('Please fill in all required fields');
            }
        }

        function performBackup() {
            if (confirm('This will create a manual backup. Continue?')) {
                alert('Backup initiated successfully! You will be notified when complete.');
            }
        }
    </script>

</body>
</html>